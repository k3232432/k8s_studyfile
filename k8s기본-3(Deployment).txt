k8s

Deployment
Deployment는 k8s에서 가장 널리 사용되는 오브젝트 입니다.
ReplicaSet을 이용하여 pod를 업데이트하고, 이력을 관리하며, 롤백(rollback)하거나 특정버전(revision)으로 돌아갈 수 있습니다.

Deployment만들기
=================echo-deployment.yml============
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1
===========================================
# Deployment 생성
kubectl apply -f echo-deployment.yml
# 리소스 확인
kubectl get po,rs,deploy
결과가 ReplicaSet을 사용했을때와 비슷해 보이지만,pod를 새로운 이미지로 업데이트할 때 효율이 있음.
기존 설정에서 이미지태그만 변경하고 재적용
===================echo-deployment-v2.yml=============
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v2
===================================================
# 새로운 이미지 업데이트
kubectl apply -f echo-deployment-v2.yml
# 리소스 확인
kubectl get po,rs,deploy
실행후 결과를 보면 pod의 기존 버전은 전부 삭제가 되며, 새로운 버전의 pod가 생성된다.
Deployment는 새로운 이미지로 업데이트하기 위해 Replicaset을 이용하는데, 버전을 업데이트 하게 되면 새로운 ReplicaSet을
생성하고 새로운 버전의 pod를 생성한다.
